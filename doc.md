# 项目技术文档

> [!NOTE]
> **UI 转换承诺**：本文档中使用的 Markdown 列表（如 `-` 或 `1.`）仅作为内容结构的逻辑标识，用于提高可读性。在最终网页实现中，这些标记将全部转换为特定的高保真 UI 样式（如网格卡片、高亮技术框或交互式面板），严禁以原始 Markdown 列表形式呈现。

## 第一章 氢原子模型

**0. 核心概述**

氢原子是最简单的原子——只有一个质子和一个电子。正因如此，它是唯一一种我们能够用数学公式精确描述其电子行为的原子，不需要任何近似或猜测。本项目正是利用这些精确公式（技术上称为"拉盖尔多项式"）来绘制氢原子的电子云。您在屏幕上看到的每一个点、每一条曲线，都直接来源于量子力学的解析解，而非模拟或估算。当前系统支持从最内层（1s）到第五层（5g）的所有轨道类型。

**1. 数学原理**

氢原子的定态薛定谔方程在球坐标系下可通过分离变量法求解，波函数被分解为径向部分 $R_{nl}(r)$ 和角向部分 $Y_{lm}(\theta, \phi)$。径向部分的解析解形式为 $R_{nl}(r) \propto e^{-\rho/2} \rho^l L_{n-l-1}^{2l+1}(\rho)$，其中 $L$ 是广义拉盖尔多项式，$\rho$ 是无量纲化的径向坐标。角向部分则由球谐函数描述。程序中，我们通过递归关系计算拉盖尔多项式的系数，并对极大/极小值进行了数值稳定性处理，最终将波函数严格归一化。

---

## 第二章 多电子体系

**0. 核心概述**

当原子中有两个或更多电子时，情况变得复杂：电子之间会相互排斥，这使得精确求解变得不可能。科学家们发展了一套名为"Hartree-Fock"的计算方法来处理这个问题——它通过反复迭代计算，找到一个近似但高精度的解。本项目采用了由 Koga 等学者计算并发布的高精度数据，覆盖了从氦 (He) 到氪 (Kr) 共 35 种元素的基态电子云。虽然这套数据非常精确，但它仍有一些理论上的局限——例如，它没有考虑一些更微妙的物理效应（如电子之间的动态回避行为，以及重原子中电子速度接近光速带来的相对论修正）。对于氪以下的元素，这些省略带来的误差通常很小，不影响可视化的定性正确性。

**1. Hartree-Fock 方法简介**

Hartree-Fock 方法是多电子体系量子化学计算的基石。其核心思想是平均场近似 (Mean-Field Approximation)：将每个电子所受的其它电子的瞬时库仑排斥简化为一个静态的等效势场。通过自洽迭代求解 Fock 方程，可以得到满足变分原理的最优单 Slater 行列式波函数。需要特别澄清的是，HF 方法是完全基于量子力学的方法，而非经典力学方法；其局限性在于忽略了电子间的动态关联，而非量子效应本身。

**2. STO 基组的选择与权衡**

Slater Type Orbital (STO) 的函数形式为 $e^{-\zeta r}$，它具有正确的核附近尖峰 (Cusp Condition) 和远程指数衰减行为，能够真实反映原子轨道的物理图景。相比之下，Gaussian Type Orbital (GTO) 的形式为 $e^{-\alpha r^2}$，虽然在多中心积分时计算更为便捷，但其在核附近过于平滑且远程衰减过快，物理保真度较差。为了追求可视化的物理真实性，我们牺牲了积分效率，坚持使用 STO 基组。

**3. Koga 基组的物理边界与局限**

尽管 Koga 数据精度极高（能量误差 $<10^{-4}$ Hartree），用户仍需了解以下物理模型的内禀限制：

- **电子关联 (Electron Correlation)**：由于平均场假设，忽略了电子之间"你来我躲"的动态规避行为，导致计算总能量略高于真实基态能量（通常在 1 eV 量级）。
- **相对论效应 (Relativistic Effects)**：模型基于非相对论薛定谔方程。对于重原子（Z > 50），内层电子的相对论收缩效应显著，但在 Kr (Z=36) 以下，此效应尚可忽略。
- **基组截断误差**：有限项 STO 展开在离核极远的区域可能出现轻微的衰减行为偏差。

**4. 参考文献**

本项目使用的 STO 基组数据主要来源于 Koga, Thakkar 等人的系列论文。

---

## 第三章 蒙特卡洛采样

**0. 核心概述**

电子云的可视化面临一个核心问题：如何将抽象的"概率密度"转化为屏幕上具体的点阵？我们的方案是使用蒙特卡洛方法——一种基于大量随机采样来逼近真实分布的统计技术。简单来说，程序会不断生成随机坐标，然后判断这个位置是否"足够可能"出现电子。经过成千上万次重复，那些电子出现概率高的区域自然会聚集更多的点，而概率低的区域则点迹稀疏。最终，点的疏密分布就直观呈现了电子云的形态。

**1. 蒙特卡洛采样原理**

蒙特卡洛方法 (Monte Carlo Method) 是一类利用随机数进行数值计算的算法。其核心思想是：如果一个量难以直接计算，可以通过大量随机采样来统计估计。在概率可视化场景下，我们反向运用该思想——已知概率密度函数 $|\Psi|^2$，利用随机采样生成符合该分布的点阵，使得点云的疏密程度直接反映概率密度的高低。根据波恩诠释，波函数的模方代表了电子在空间中的概率密度，因此点云可视化的核心目标是在三维空间中生成密度与概率密度成正比的离散点阵。直接对整个原子空间进行均匀随机投点（全空间拒绝采样）效率极低，通常接受率不足 1%。为此，我们采用"分而治之"策略，将各向同性的径向分布与各向异性的角向分布分开处理。

**2. 逆 CDF 方法 (径向采样)**

电子云在径向上的分布由径向分布函数 $D(r) = r^2 R(r)^2$ 描述，这是光滑的一维函数。我们预先计算其累积分布函数 (CDF)，并建立反函数查找表。采样时，只需生成一个均匀随机数 $u \sim U(0,1)$，然后通过二分查找即可得到对应的半径 $r = CDF^{-1}(u)$。这种方法保证每次计算必定产生一个有效的半径值，效率为 100%，且无统计偏差。

**3. 拒绝采样 (角向采样)**

p, d, f 轨道的角向分布形状复杂（如哑铃形、花瓣形），难以用简单的逆变换处理。因此，我们对角向部分采用拒绝采样：首先在单位球面上均匀投点生成随机方向 $(\theta, \phi)$，然后计算该方向上的角向概率密度 $|Y_{lm}|^2$，再以此作为接受概率进行测试。虽然会浪费约 50% 的计算量，但相比处理复杂的三维边界条件，这是数学上最稳健的方案。

**4. 程序实现流程**

[此处应插入 Mermaid 流程图：开始 -> 径向 CDF 预计算 -> 生成随机数 u -> 查表得 r -> 球面均匀投点 -> 计算角向概率 w -> 拒绝测试 -> 坐标变换输出]

---

## 第四章 杂化轨道计算

**0. 核心概述**

在化学中，"杂化"是一个重要概念——它描述了原子轨道如何"混合"形成新的轨道，以便更好地与其他原子成键。例如，碳原子的四个 $sp^3$ 杂化轨道指向四面体的四个顶点，这解释了甲烷分子的形状。本项目实现了杂化轨道的可视化计算：您可以选择一组原子轨道和目标几何构型，程序会自动计算出最佳的混合方式，并展示杂化后的轨道形态。为了鼓励探索，系统甚至允许一些"非常规"的组合（如不同能层的轨道混搭），让您直观观察结果——虽然这在现实分子中可能不会发生，但它能帮助理解杂化的数学本质。

**1. 杂化模型的开放性与局限性**

传统化学教学对杂化轨道的能级组合有严格限制（如 $sp^3$ 必须来自同一主层）。然而，在数学上，波函数的线性组合是普适的，不存在"禁阻"。我们开放异能级混搭的目的在于提供教育探索空间，让用户直观观察当组合"不合理"时波瓣的畸变表现。同时，由于 SVD 算法的内禀性质，即使物理意义存疑的组合，其数学结果（系数矩阵）也始终满足正交归一条件，具备完全的鲁棒性。

**2. 为什么只开放特定组合**

尽管数学上允许任意线性组合，但并非所有组合都具有化学意义或可视化价值。我们限制可选组合的原因如下：

1. **几何指向性**：组合必须能够产生明确的几何指向性（如四面体、八面体），否则 SVD 算法虽能给出正交系数，但结果波瓣形状杂乱无章，缺乏教学意义。
2. **对称性保护**：某些纯轨道（如单独的 s 或多个 p）本身已具备完整对称性，强行"杂化"反而破坏物理图景。
3. **交互约束**：UI 层面的约束简化了用户交互，避免因无效组合导致的困惑。程序内部通过 `isValidHybridization` 函数对用户选择进行预校验，只有满足几何匹配条件的组合才会进入计算流程。

**3. 杂化系数计算的数学本质**

杂化问题本质上是一个正交 Procrustes 问题：给定一组原子轨道（如一个 s 和三个 p）和一组目标几何方向（如四面体的四个顶点方向），寻找一个正交变换矩阵 $C$，使得变换后的杂化轨道主瓣方向与目标方向的偏差最小。我们首先计算原子轨道与目标方向的投影矩阵 $M$，然后对其进行奇异值分解 $M = U \Sigma V^T$，最优的系数矩阵即为 $C = U V^T$。该方法保证了杂化轨道之间严格正交，且每个轨道严格归一。

**4. 程序实现流程**

[此处应插入 Mermaid 流程图：输入轨道基组 -> 定义目标几何方向 -> 计算投影矩阵 M -> SVD 分解 -> 构造系数矩阵 C -> 线性组合生成杂化波函数 -> 输出]

---

## 第五章 轨道能量

**0. 核心概述**

在量子力学中，给定轨道的能量（本征值）是一个全局常数——这意味着电子在轨道的任何位置，其总能量都是严格相等的。本项目并非要展示那种随空间位置变化的“局域能量”（如动能与势能的简单加和），而是希望展示这个恒定的总能量如何在空间分布中被“承载”。我们通过观察能量随概率分布的累积过程，可以直观地看到：虽然能量本征值在空间中是均匀的，但不同区域对这一能量结果的“权重”贡献却截然不同。这有助于理解为什么某些经常“钻入”核附近的轨道（如 4s）会比平均距离更近的轨道（如 3d）拥有更低的能量。

**1. 轨道本征值的物理来源**

在 Hartree-Fock 理论框架下，每个分子轨道对应一个定态能量本征值 $\varepsilon_i$。根据 Koopmans 定理，在冻结轨道近似下，这一本征值反映了电子在原子中的束缚强度。本项目采用 Koga 高精度基组计算得到的本征值作为基准，这些数值在数学上是全局唯一的常量，不随空间坐标 $r$ 改变。

**2. 累积能量函数的物理本质**

我们构造的累积能量函数 $E(R) = \int_0^R \varepsilon |\psi|^2 \cdot 4\pi r^2 dr$ 本质上是将“全局恒定的能量”按照“局域出现的概率”进行空间加权。需要明确的是，这并不同于物理学中某些变分法讨论的“局域动能+局域势能”之和，因为对于定态波函数，二者的局部涨落总是精确抵消。我们的公式旨在通过概率密度的加权积分，可视化地展示哪些空间区域在物理上“支撑”了该轨道的能量特征。这种处理方式在保持数学严谨性的同时，为理解原子能级顺序提供了一个独特的教学视角。

---

## 第六章 相位与等值面

**0. 核心概述**

波函数不仅有"大小"，还有"符号"（正或负），这在化学中称为"相位"。相位信息对于理解化学键的形成至关重要——当两个轨道的相位相同时，它们会建设性叠加形成成键轨道；相位相反时则会相消形成反键轨道。本项目不仅绘制电子云的形状（等值面），还明确标示出不同相位的区域（通常以红色和蓝色区分）。例如，p 轨道的两个"哑铃瓣"就具有相反的相位。此外，系统实现了智能的"分波瓣"渲染，能够自动识别并分别为每个独立的波瓣着色。

**1. 相位矫正算法**

实数球谐函数的计算涉及 Condon-Shortley 相位因子。不同领域（物理学 vs 化学）对该相位的约定可能不同，导致轨道的正负区域翻转。我们通过在代码中对特定轨道引入符号修正因子，确保最终可视化结果与化学界的通用约定一致。

**2. 等值面生成算法 (Marching Cubes)**

Marching Cubes 是一种经典的标量场体素化重构算法，用于将三维波函数场转化为多边形网格曲面。算法遍历空间中的每个立方体体素，根据其八个顶点处波函数值与阈值的比较结果（共 256 种拓扑情况），查表生成相应的三角形面片，最终拼接成平滑的等值面网格。

**3. 分波瓣着色算法**

对于存在节面的轨道（如 p, d, f），等值面由多个互不连通的波瓣构成。我们首先使用 Union-Find 并查集算法对生成的网格三角形进行连通域标记，识别出各个独立的波瓣。然后，检测每个波瓣中心点处的原始波函数符号，将正值波瓣着色为红色，负值波瓣着色为蓝色。

**4. 程序实现流程**

[此处应插入 Mermaid 流程图：体素化网格 -> 计算顶点场值 -> Marching Cubes 查表 -> 生成三角面 -> 连通域分析 (Union-Find) -> 相位检测 -> 着色输出]

---

## 第七章 数据统计面板

**0. 核心概述**

为了让您能够验证可视化的准确性，项目提供了一个实时统计面板。这个面板同时显示两条曲线：一条是根据理论公式直接计算出的"标准答案"，另一条是从当前采样点统计出来的实际分布。随着采样的持续进行，您会看到统计曲线逐渐逼近理论曲线——这个"从混沌到有序"的收敛过程，本身就是对蒙特卡洛方法有效性的直观证明。

**1. 理论曲线的来源**

径向分布曲线的理论基准由解析公式直接计算得到：$D(r) = r^2 |R_{nl}(r)|^2$。角向分布的理论基准同样由球谐函数的解析形式直接给出。这些曲线代表了"标准答案"，是采样直方图应该逼近的目标。

**2. 径向分布的采样与计算**

对于每个被接受的采样点 $(x, y, z)$，首先计算其半径 $r = \sqrt{x^2+y^2+z^2}$，然后根据预设的径向分箱边界将其归入相应的 Bin 中。随着采样点数增加，归一化后的直方图逐渐逼近理论的径向分布曲线。能量相关曲线/直方图同理，采用累积能量的径向分布进行展示。

**3. 角向分布的采样与计算**

角向分布的统计依赖于将采样点的方向向量 $(\theta, \phi)$ 投影到预定义的角度 Bin 中。由于角向分布通常呈现高对称性，可以利用对称性合并统计结果，提高收敛速度。

**4. 数据更新与截断处理**

统计面板采用动态更新机制：随着采样的持续进行，直方图实时刷新，逐步逼近理论曲线，形成"从混沌到有序"的视觉收敛效果。为了保证性能和视觉清晰度，对极远处（远超玻尔半径数倍）的低概率采样点进行截断处理，不纳入主直方图统计。
